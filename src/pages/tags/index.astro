---
import { getCollection } from "astro:content";
import { SITE_DESCRIPTION, SITE_TITLE } from "../../consts";
import Layout from "../../layouts/Layout.astro";

const allPosts = await getCollection("posts");
const tags = allPosts
  .filter((post) => !post.data.draft)
  .flatMap((post) => post.data.tags || []);

const tagCounts = tags.reduce(
  (acc, tag) => {
    acc[tag] = (acc[tag] || 0) + 1;
    return acc;
  },
  {} as Record<string, number>,
);

const sortedTags = Object.entries(tagCounts).sort((a, b) => b[1] - a[1]);

const pageTitle = `标签墙 - ${SITE_TITLE}`;
---

<Layout
  title={pageTitle}
  description={SITE_DESCRIPTION}
  containerClass="max-w-7xl"
  className="!p-0"
>
  <main class="flex justify-center lg:my-6">
    <article
      class="w-full max-w-[210mm] bg-white shadow-2xl dark:bg-zinc-900"
      style="min-height: 297mm;"
    >
      <div class="h-full overflow-auto p-6">
        <header class="mb-6 border-b border-zinc-200 pb-4 dark:border-zinc-700">
          <h1 class="text-xl font-semibold">标签墙</h1>
          <p class="mt-2 text-sm text-zinc-600 dark:text-zinc-400">
            共 {sortedTags.length} 个标签
          </p>
        </header>

        {
          sortedTags.length === 0 ? (
            <p class="text-sm text-zinc-500">暂无标签</p>
          ) : (
            <div class="flex flex-wrap gap-3">
              {sortedTags.map(([tag, count]) => (
                <a
                  href={`/tags/${tag}`}
                  class="group flex items-center gap-1.5 rounded-full bg-zinc-100 px-3 py-1.5 text-sm transition-colors hover:bg-blue-100 dark:bg-zinc-800 dark:hover:bg-blue-900/30"
                >
                  <span class="font-medium text-zinc-700 group-hover:text-blue-700 dark:text-zinc-300 dark:group-hover:text-blue-300">
                    #{tag}
                  </span>
                  <span class="rounded-full bg-zinc-200 px-1.5 py-0.5 text-xs text-zinc-500 group-hover:bg-blue-200 group-hover:text-blue-700 dark:bg-zinc-700 dark:group-hover:bg-blue-800 dark:group-hover:text-blue-300 border border-transparent">
                    {count}
                  </span>
                </a>
              ))}
            </div>
          )
        }
      </div>
    </article>
  </main>
</Layout>

<style>
  /* 覆盖全局 article a 的下划线样式 */
  article a {
    text-decoration: none;
  }
</style>
